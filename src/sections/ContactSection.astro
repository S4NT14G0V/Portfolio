---
import Actions from "../components/Actions.astro";
const email = "santiagot3p@gmail.com";
---

<section
  id="contact"
  class="flex flex-col justify-center items-center gap-10 py-16 sm:py-32 w-full px-10 sm:w-1/2 min-h-screen z-20"
>
  <h2 class="text-3xl sm:text-4xl font-bold text-center">Contact Me</h2>
  <p class="text-center text-black/70 dark:text-[#ccc] max-w-xl">
    Got a question, a project idea, or just want to say hello? I’m always eager
    to collaborate, solve challenges, or explore new opportunities together.
  </p>

  <div class="flex flex-col items-center gap-2">
    <p class="text-black/90 dark:text-[#ccc] text-sm">Email me directly:</p>

    <div
      class="flex items-center gap-3 bg-white/20 border-1 border-gray-200 dark:border-gray-700 dark:bg-black/20 px-4 py-2 rounded-xl select-none"
    >
      <span
        id="email-text"
        class="text-sm text-gray-800 dark:text-[#ccc] select-all"
      >
        {email}
      </span>

      <button
        id="copy-btn"
        aria-label="Copy email"
        class="relative group flex items-center justify-center p-2 rounded-xl text-black dark:text-white hover:bg-black/10 dark:hover:bg-white/10 text-sm font-medium transition"
        type="button"
      >
        <svg
          id="copy-icon"
          class="transition-opacity"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 640 640"
          width="20"
          height="20"
          fill="currentColor"
        >
          <path d="M360 160L280 160C266.7 160 256 149.3 256 136C256 122.7 266.7 112 280 112L360 112C373.3 112 384 122.7 384 136C384 149.3 373.3 160 360 160zM360 208C397.1 208 427.6 180 431.6 144L448 144C456.8 144 464 151.2 464 160L464 512C464 520.8 456.8 528 448 528L192 528C183.2 528 176 520.8 176 512L176 160C176 151.2 183.2 144 192 144L208.4 144C212.4 180 242.9 208 280 208L360 208zM419.9 96C407 76.7 385 64 360 64L280 64C255 64 233 76.7 220.1 96L192 96C156.7 96 128 124.7 128 160L128 512C128 547.3 156.7 576 192 576L448 576C483.3 576 512 547.3 512 512L512 160C512 124.7 483.3 96 448 96L419.9 96z"></path>
        </svg>

        <svg
          id="check-icon"
          class="absolute opacity-0 transition-opacity"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 640 640"
          width="20"
          height="20"
          fill="currentColor"
        >
          <path d="M530.8 134.1C545.1 144.5 548.3 164.5 537.9 178.8L281.9 530.8C276.4 538.4 267.9 543.1 258.5 543.9C249.1 544.7 240 541.2 233.4 534.6L105.4 406.6C92.9 394.1 92.9 373.8 105.4 361.3C117.9 348.8 138.2 348.8 150.7 361.3L252.2 462.8L486.2 141.1C496.6 126.8 516.6 123.6 530.9 134z"></path>
        </svg>

        <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-1 px-2 py-1 text-xs text-white bg-purple-900 dark:text-black dark:bg-purple-200 rounded opacity-0 group-hover:opacity-100 transition-opacity z-50 whitespace-nowrap pointer-events-none">
            Copy
        </div>
      </button>
    </div>
  </div>

  <div class="flex flex-col items-center gap-2">
    <p class="text-black/90 dark:text-[#ccc] text-sm">Or use other ways:</p>
    <Actions />
  </div>

  <script is:inline>
    // Seleccionamos los elementos del DOM una sola vez
    const copyBtn = document.getElementById("copy-btn");
    const emailText = document.getElementById("email-text");
    const copyIcon = document.getElementById("copy-icon");
    const checkIcon = document.getElementById("check-icon");

    // Función asíncrona para copiar
    async function copyEmail() {
      // Usamos el elemento guardado previamente
      if (!emailText?.textContent) return;

      try {
        // Copiamos al portapapeles
        await navigator.clipboard.writeText(emailText.textContent);

        // Mostramos el ícono de "check" y ocultamos el de copiar
        copyIcon.style.opacity = "0";
        checkIcon.style.opacity = "1";

        // Después de 2 segundos, revertimos la animación
        setTimeout(() => {
          checkIcon.style.opacity = "0";
          copyIcon.style.opacity = "1";
        }, 2000);
      } catch (err) {
        console.error("Failed to copy email: ", err);
        // Opcional: mostrar un mensaje de error al usuario
      }
    }

    // Añadimos el listener solo si el botón existe
    if (copyBtn) {
      copyBtn.addEventListener("click", copyEmail);
    }
  </script>
</section>